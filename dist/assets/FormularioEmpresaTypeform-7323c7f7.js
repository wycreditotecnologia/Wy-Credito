import{c as H,j as e,r as d,B,S as K,A as W,a as F,b as L,d as $,L as v,I as M,C as R}from"./index-a97f1121.js";import"./select-c7f8521e.js";import{B as O}from"./Business-7bdb93f4.js";const U=H(e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2m6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56M12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56m2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8M12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96M14.34 14H9.66c-.09-.66-.16-1.32-.16-2s.07-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2m.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56M16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2z"})),C=({title:f,description:r,children:m,stepIndex:z=0,totalSteps:t=1,onPrev:l,showProgress:n=!0,autoFit:u=!0,layout:w="single",aside:E=null,onSaveContinue:j,sessionId:b})=>{const i=Math.round((z+1)/Math.max(t,1)*100),N=d.useRef(null),[D,k]=d.useState("justify-center");return d.useEffect(()=>{if(!u)return;const S=()=>{const p=window.innerHeight||800,P=140,A=0,x=Math.max(320,p-P-A),_=N.current;if(_){const c=_.offsetHeight;k(c>x*.85?"justify-start":"justify-center")}};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[m,u]),e.jsxs("div",{className:`min-h-[50vh] sm:min-h-[56vh] flex flex-col items-center ${u?D:"justify-start pt-8 sm:pt-12"}`,children:[n&&e.jsxs("div",{className:"w-full max-w-[860px] px-4 sm:px-6 mx-auto",children:[e.jsx("div",{className:"h-1 w-full bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${i}%`}})}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Paso ",z+1," de ",t]})]}),e.jsxs("div",{className:"w-full max-w-[1100px] px-4 sm:px-6 mt-2 sm:mt-3 mx-auto",ref:N,children:[w==="single"&&e.jsxs("div",{className:"space-y-5 sm:space-y-6",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold tracking-tight text-foreground",children:f}),r&&e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:r}),e.jsx("div",{className:"mt-3 sm:mt-4",children:m}),e.jsx("div",{className:"pt-4 sm:pt-6",children:e.jsxs("div",{className:"flex items-center justify-start gap-4",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Paso ",z+1," de ",t]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{variant:"outline",onClick:l,disabled:!l,children:"Atrás"}),e.jsx(K,{onClick:()=>{j&&j()},children:"Guardar y Continuar"})]})]})})]}),w==="two"&&e.jsxs("div",{className:"grid md:grid-cols-[360px_1fr] gap-6",children:[e.jsxs("div",{children:[l&&e.jsx("button",{type:"button",className:"text-sm text-muted-foreground hover:text-foreground mb-3",onClick:l,"aria-label":"Volver",children:"← Volver"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold tracking-tight mb-1 text-foreground",children:f}),r&&e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:r})]}),e.jsxs("div",{children:[m,e.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Tip: Presione Enter o use la barra flotante para avanzar."})]})]}),w==="three"&&e.jsxs("div",{className:"grid md:grid-cols-[300px_1fr_300px] gap-6",children:[e.jsxs("div",{children:[l&&e.jsx("button",{type:"button",className:"text-sm text-muted-foreground hover:text-foreground mb-3",onClick:l,"aria-label":"Volver",children:"← Volver"}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold tracking-tight mb-1 text-foreground",children:f}),r&&e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:r})]}),e.jsxs("div",{children:[m,e.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Tip: Presione Enter o use la barra flotante para avanzar."})]}),e.jsx("div",{children:E})]})]})]})},X=({onStepComplete:f,sessionId:r,registerStepActions:m,hideLocalActions:z})=>{const[t,l]=d.useState({nit:"",razonSocial:"",tipoEmpresa:"",paginaWeb:"",redesSociales:{facebook:"",instagram:"",linkedin:"",twitter:""},autorizacionConsulta:!1,habeasData:!1}),[n,u]=d.useState({}),[w,E]=d.useState(!1),[j,b]=d.useState(""),[i,N]=d.useState(0),D=a=>{const s=[3,7,13,17,19,23,29,37,41,43,47,53,59,67,71],o=String(a||"").replace(/\D/g,"");let g=0;for(let y=0;y<o.length&&y<s.length;y++){const V=parseInt(o.charAt(o.length-1-y),10)||0;g+=V*s[y]}const h=g%11;return h>1?11-h:h};d.useEffect(()=>{try{const a=localStorage.getItem(`pre_nit_${r}`)||"",s=localStorage.getItem(`pre_razon_social_${r}`)||"";l(o=>({...o,nit:o.nit||a,razonSocial:o.razonSocial||s}))}catch{}},[r]);const k=[{value:"sas",label:"Sociedad por Acciones Simplificada (SAS)"},{value:"sa",label:"Sociedad Anónima (SA)"},{value:"ltda",label:"Sociedad de Responsabilidad Limitada (LTDA)"},{value:"colectiva",label:"Sociedad Colectiva"},{value:"comandita_simple",label:"Sociedad en Comandita Simple"},{value:"comandita_acciones",label:"Sociedad en Comandita por Acciones"},{value:"empresa_unipersonal",label:"Empresa Unipersonal"},{value:"persona_natural",label:"Persona Natural"}],S=k.length>=8?"md:grid-cols-3":"md:grid-cols-2",p=(a,s)=>{if(a.includes(".")){const[o,g]=a.split(".");l(h=>({...h,[o]:{...h[o],[g]:s}}))}else l(o=>({...o,[a]:s}));n[a]&&u(o=>({...o,[a]:""}))},P=()=>{const a={};return t.nit.trim()?/^\d{9,11}$/.test(t.nit.replace(/[.-]/g,""))||(a.nit="El NIT debe tener entre 9 y 11 dígitos"):a.nit="El NIT es obligatorio",t.razonSocial.trim()?t.razonSocial.trim().length<3&&(a.razonSocial="La razón social debe tener al menos 3 caracteres"):a.razonSocial="La razón social es obligatoria",t.tipoEmpresa||(a.tipoEmpresa="Debe seleccionar el tipo de empresa"),t.paginaWeb&&!/^https?:\/\/.+\..+/.test(t.paginaWeb)&&(a.paginaWeb="Ingrese una URL válida (ej: https://www.ejemplo.com)"),t.autorizacionConsulta||(a.autorizacionConsulta="Debe autorizar la consulta en centrales de riesgo"),t.habeasData||(a.habeasData="Debe aceptar el tratamiento de datos personales"),u(a),Object.keys(a).length===0},A=()=>{const a={};switch(i){case 0:{t.razonSocial.trim()?t.razonSocial.trim().length<3&&(a.razonSocial="La razón social debe tener al menos 3 caracteres"):a.razonSocial="La razón social es obligatoria";break}case 1:{if(!t.nit.trim())a.nit="El NIT es obligatorio";else{const s=t.nit.replace(/[.-]/g,"");/^\d{9,11}$/.test(s)||(a.nit="El NIT debe tener entre 9 y 11 dígitos")}break}case 2:{t.tipoEmpresa||(a.tipoEmpresa="Debe seleccionar el tipo de empresa");break}case 3:{t.paginaWeb&&!/^https?:\/\/.+\..+/.test(t.paginaWeb)&&(a.paginaWeb="Ingrese una URL válida (ej: https://www.ejemplo.com)");break}case 4:{t.autorizacionConsulta||(a.autorizacionConsulta="Debe autorizar la consulta en centrales de riesgo"),t.habeasData||(a.habeasData="Debe aceptar el tratamiento de datos personales");break}}return u(a),Object.keys(a).length===0},x=5,_=async()=>{if(b(""),!!P()){if(!r){b("Error: No se encontró una sesión activa. Por favor, reinicie el proceso.");return}E(!0);try{const a=(t.nit||"").replace(/[.-]/g,"").trim(),o={nit:a&&/^\d{9,11}$/.test(a)?`${a}-${D(a)}`:(t.nit||"").trim(),razon_social:t.razonSocial.trim(),tipo_empresa:t.tipoEmpresa,sitio_web:(t.paginaWeb||"").trim()||null,autorizacion_consulta:t.autorizacionConsulta,habeas_data:t.habeasData},g=await fetch("/api/orchestrator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"submit_form_step",sessionId:r,payload:{currentStep:1,stepData:o}})}),h=await g.json();if(!g.ok)throw new Error(h.error||"Error al enviar los datos");f&&f(2)}catch(a){console.error("Error al enviar formulario:",a),b(a.message||"Error al enviar los datos. Por favor, inténtelo de nuevo.")}finally{E(!1)}}},c=async()=>{b(""),A()&&(i<x-1?N(s=>s+1):await _())},T=()=>{b(""),u({}),N(a=>Math.max(0,a-1))},I=a=>{a.key==="Enter"&&(a.preventDefault(),c())},Q=(a,s)=>{p(a,s),setTimeout(()=>{c()},0)};return d.useEffect(()=>{m&&m({onSaveContinue:c})},[m]),e.jsxs("form",{onSubmit:a=>a.preventDefault(),children:[j&&e.jsx("div",{className:"w-full max-w-[720px] mx-auto px-4 sm:px-6",children:e.jsxs(W,{variant:"destructive",className:"mb-6",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx(L,{children:"Error"}),e.jsx($,{children:j})]})}),i===0&&e.jsx(C,{title:"¿Cuál es la razón social de la empresa?",description:"Escribe el nombre legal completo tal como aparece en el RUT.",stepIndex:i,totalSteps:x,showProgress:!1,layout:"single",onSaveContinue:c,sessionId:r,autoFit:!1,children:e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx(v,{htmlFor:"razonSocial",className:"text-base",children:"Razón Social"}),e.jsx(M,{id:"razonSocial",value:t.razonSocial,onChange:a=>p("razonSocial",a.target.value),onKeyDown:I,placeholder:"Empresa Ejemplo S.A.S."}),n.razonSocial&&e.jsx("p",{className:"text-sm text-destructive mt-2",children:n.razonSocial})]})}),i===1&&e.jsx(C,{title:"Ingrese el NIT de la empresa",description:"Solo números, sin puntos ni guiones.",stepIndex:i,totalSteps:x,onPrev:T,showProgress:!1,layout:"single",onSaveContinue:c,sessionId:r,autoFit:!1,children:e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx(v,{htmlFor:"nit",className:"text-base",children:"NIT"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx(M,{id:"nit",value:t.nit,onChange:a=>p("nit",a.target.value),onKeyDown:I,placeholder:"123456789",className:"pl-9"})]}),n.nit?e.jsx("p",{className:"text-sm text-destructive mt-2",children:n.nit}):(()=>{const a=String(t.nit||"").replace(/\D/g,"");if(/^\d{9,11}$/.test(a)){const s=D(a);return e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["DV sugerido: ",s," • Se guardará como ",a,"-",s]})}return null})()]})}),i===2&&e.jsxs(C,{title:"Seleccione el tipo de empresa",description:"Elija la figura jurídica que corresponde.",stepIndex:i,totalSteps:x,onPrev:T,showProgress:!1,layout:"single",onSaveContinue:c,sessionId:r,autoFit:!1,children:[e.jsx("div",{className:"mb-2",children:e.jsx(v,{className:"text-base",children:"Tipo de Empresa"})}),e.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 ${S} gap-3`,children:k.map(a=>{const s=t.tipoEmpresa===a.value;return e.jsx(B,{type:"button",onClick:()=>Q("tipoEmpresa",a.value),className:`justify-start h-auto py-3 px-4 text-left rounded-xl transition-all duration-150
                    ${s?"border border-primary/60 ring-2 ring-primary/30 bg-primary/5":"border border-transparent hover:bg-muted/30"}
                    hover:-translate-y-[1px]`,variant:s?"default":"ghost",children:a.label},a.value)})}),n.tipoEmpresa&&e.jsx("p",{className:"text-sm text-destructive mt-2",children:n.tipoEmpresa})]}),i===3&&e.jsx(C,{title:"Presencia digital (opcional)",description:"Comparta su página web y redes sociales si las tiene.",stepIndex:i,totalSteps:x,onPrev:T,showProgress:!1,layout:"single",onSaveContinue:c,sessionId:r,autoFit:!1,children:e.jsx("div",{className:"grid grid-cols-12 gap-4",children:e.jsxs("div",{className:"col-span-12",children:[e.jsx(v,{htmlFor:"paginaWeb",className:"text-base",children:"Página Web"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx(M,{id:"paginaWeb",value:t.paginaWeb,onChange:a=>p("paginaWeb",a.target.value),onKeyDown:I,placeholder:"https://www.miempresa.com",className:"pl-9"})]}),n.paginaWeb&&e.jsx("p",{className:"text-sm text-destructive mt-2",children:n.paginaWeb})]})})}),i===4&&e.jsx(C,{title:"Autorizaciones y consentimientos",description:"Necesitamos tu autorización para continuar con el proceso.",stepIndex:i,totalSteps:x,onPrev:T,showProgress:!1,layout:"single",onSaveContinue:c,sessionId:r,autoFit:!1,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(R,{id:"autorizacion_consulta",checked:t.autorizacionConsulta,onCheckedChange:a=>p("autorizacionConsulta",!!a)}),e.jsxs(v,{htmlFor:"autorizacion_consulta",className:"text-sm",children:["Autorizo a Wy Crédito para consultar mi información en las centrales de riesgo (DataCrédito, CIFIN, etc.) para evaluar mi solicitud de crédito. Consulte la"," ",e.jsx("a",{href:"/politica-de-privacidad",target:"_blank",rel:"noopener noreferrer",className:"text-primary font-semibold underline hover:opacity-90",children:"Política de Tratamiento de Datos Personales"}),"."]})]}),n.autorizacionConsulta&&e.jsxs(W,{variant:"destructive",className:"mt-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx(L,{children:"Error"}),e.jsx($,{children:n.autorizacionConsulta})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(R,{id:"habeas_data",checked:t.habeasData,onCheckedChange:a=>p("habeasData",!!a)}),e.jsxs(v,{htmlFor:"habeas_data",className:"text-sm",children:["Acepto el tratamiento de mis datos personales de acuerdo con la"," ",e.jsx("a",{href:"/politica-de-privacidad",target:"_blank",rel:"noopener noreferrer",className:"text-primary font-semibold underline hover:opacity-90",children:"Política de Tratamiento de Datos Personales"})," de Wy Crédito y autorizo el uso de esta información para fines comerciales y de marketing."]})]}),n.habeasData&&e.jsxs(W,{variant:"destructive",className:"mt-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx(L,{children:"Error"}),e.jsx($,{children:n.habeasData})]})]})})]})};export{X as default};
