import{c as A,j as e,r as l,A as B,a as K,b as I,d as U,e as L,f as k,F as M,L as m,B as H,g as Q}from"./index-a97f1121.js";const V=A(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2z"})),J=({onStepComplete:g,sessionId:u,onProgressUpdate:h})=>{const[r,b]=l.useState({monto_solicitado:"",plazo_solicitado:"",destino_credito:"",ingresos_mensuales:"",egresos_mensuales:"",patrimonio:"",url_declaracion_renta:"",url_estados_financieros:""}),[_,T]=l.useState([]),[t,v]=l.useState({}),[j,N]=l.useState(!1),[y,w]=l.useState(""),f=l.useRef(null),E=l.useRef(null),D=l.useRef(null),F=l.useRef(null),S=l.useRef(null),z=l.useRef(null),C=[f,E,D,F,S,z];l.useEffect(()=>{var s;(s=f.current)==null||s.focus()},[]),l.useEffect(()=>{typeof h=="function"&&h({currentQuestion:1,totalQuestions:8})},[h]);const c=s=>{const{name:a,value:i}=s.target;b(n=>({...n,[a]:i})),t[a]&&v(n=>({...n,[a]:""}))},q={url_declaracion_renta:"declaracion_renta",url_estados_financieros:"estados_financieros"},R=(s,a,i={})=>{b(o=>({...o,[a]:s}));const n=q[a]||a;T(o=>[...o.filter(x=>x.tipo_documento!==n),{tipo_documento:n,nombre_archivo:i.nombre_archivo||"",url_storage:s,tamaÃ±o_archivo:i.tamaÃ±o_archivo||0,tipo_mime:i.tipo_mime||"application/pdf"}])},O=()=>{const s={};["monto_solicitado","plazo_solicitado","ingresos_mensuales","egresos_mensuales","patrimonio"].forEach(o=>{const p=String(r[o]||"").trim(),x=o==="plazo_solicitado"?parseInt(p,10):parseFloat(p);p?(Number.isNaN(x)||x<=0)&&(s[o]="Debe ser un nÃºmero mayor que 0"):s[o]="Este campo es obligatorio"}),String(r.destino_credito||"").trim()||(s.destino_credito="Debe especificar el destino del crÃ©dito");const i=["declaracion_renta","estados_financieros"],n=new Set(_.map(o=>o.tipo_documento));return i.forEach(o=>{n.has(o)||(s[o]=o==="declaracion_renta"?"Debe subir la declaraciÃ³n de renta en PDF (â‰¤10MB).":"Debe subir los estados financieros en PDF (â‰¤10MB).")}),v(s),Object.keys(s).length===0},P=async s=>{if(s&&typeof s.preventDefault=="function"&&s.preventDefault(),!!O()){N(!0),w("");try{if(!u)throw new Error("No se encontrÃ³ una sesiÃ³n activa. Por favor, reinicie el proceso.");const a={monto_solicitado:parseFloat(r.monto_solicitado),plazo_solicitado:parseInt(r.plazo_solicitado,10),destino_credito:String(r.destino_credito||"").trim(),ingresos_mensuales:parseFloat(r.ingresos_mensuales),egresos_mensuales:parseFloat(r.egresos_mensuales),patrimonio:parseFloat(r.patrimonio),documentos:_.map(o=>({tipo_documento:o.tipo_documento,nombre_archivo:o.nombre_archivo,url_storage:o.url_storage,tamaÃ±o_archivo:o.tamaÃ±o_archivo,tipo_mime:o.tipo_mime}))};console.log("ðŸ“Š Enviando informaciÃ³n financiera:",a);const i=await fetch("/api/orchestrator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"submit_form_step",sessionId:u,payload:a})}),n=await i.json();if(!i.ok)throw new Error(n.error||"Error al enviar la informaciÃ³n financiera");console.log("âœ… InformaciÃ³n financiera enviada exitosamente:",n),g&&g(n.nextStep||4)}catch(a){console.error("âŒ Error al enviar informaciÃ³n financiera:",a),w(a.message||"Error al enviar los datos. Por favor, intÃ©ntelo de nuevo.")}finally{N(!1)}}},d=(s,a)=>{var i;if(s.key==="Enter"){s.preventDefault();for(let n=a+1;n<C.length;n++){const o=(i=C[n])==null?void 0:i.current;if(o){o.focus();return}}P()}};return e.jsxs("form",{onSubmit:P,className:"max-w-[800px] mx-auto",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold tracking-tight text-center mb-6",children:"ðŸ“Š InformaciÃ³n Financiera"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center mb-6",children:"Adjunte sus documentos financieros y proporcione informaciÃ³n sobre el uso de los recursos"}),y&&e.jsxs(B,{variant:"destructive",className:"mb-6",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(I,{children:"Error"}),e.jsx(U,{children:y})]}),e.jsxs("div",{className:"mt-12",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"mr-2 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold border-b pb-2 mb-6",children:"Documentos Financieros"})]}),e.jsx(k,{className:"my-8"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-6",children:"Todos los documentos deben estar en formato PDF y no superar los 10MB"}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-12",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(M,{label:"DeclaraciÃ³n de Renta (Ãšltimo aÃ±o fiscal)",sessionId:u,documentType:"url_declaracion_renta",onUploadSuccess:R,helperText:"PDF â‰¤ 10MB. Ãšltima declaraciÃ³n presentada."}),t.declaracion_renta&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:t.declaracion_renta})]})}),e.jsx("div",{className:"col-span-12",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(M,{label:"Estados Financieros (Ãšltimos 2 aÃ±os)",sessionId:u,documentType:"url_estados_financieros",onUploadSuccess:R,helperText:"PDF â‰¤ 10MB. Estados auditados o certificados."}),t.estados_financieros&&e.jsx("p",{className:"text-xs text-destructive mt-1",children:t.estados_financieros})]})})]})]}),e.jsxs("div",{className:"mt-12",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"mr-2 text-primary"}),e.jsx("h3",{className:"text-xl font-semibold border-b pb-2 mb-6",children:"Datos cuantitativos"})]}),e.jsx(k,{className:"my-8"}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-12 sm:col-span-6",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(m,{htmlFor:"monto_solicitado",children:"Monto solicitado (COP)"}),e.jsx("input",{id:"monto_solicitado",name:"monto_solicitado",type:"number",step:"0.01",value:r.monto_solicitado,onChange:c,ref:f,onKeyDown:s=>d(s,0),placeholder:"Ej: 50000000",className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"}),t.monto_solicitado?e.jsx("p",{className:"text-xs text-destructive mt-1",children:t.monto_solicitado}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ingrese el monto solicitado en COP, mayor que 0."})]})}),e.jsx("div",{className:"col-span-12 sm:col-span-6",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(m,{htmlFor:"plazo_solicitado",children:"Plazo solicitado (meses)"}),e.jsx("input",{id:"plazo_solicitado",name:"plazo_solicitado",type:"number",step:"1",value:r.plazo_solicitado,onChange:c,ref:E,onKeyDown:s=>d(s,1),placeholder:"Ej: 24",className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"}),t.plazo_solicitado?e.jsx("p",{className:"text-xs text-destructive mt-1",children:t.plazo_solicitado}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Meses de plazo, nÃºmero entero mayor que 0."})]})}),e.jsx("div",{className:"col-span-12",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(m,{htmlFor:"destino_credito",children:"Destino del crÃ©dito"}),e.jsx("input",{id:"destino_credito",name:"destino_credito",type:"text",value:r.destino_credito,onChange:c,ref:D,onKeyDown:s=>d(s,2),placeholder:"Ej: Capital de trabajo, expansiÃ³n, compra de maquinaria, etc.",className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"}),t.destino_credito?e.jsx("p",{className:"text-xs text-destructive mt-1",children:t.destino_credito}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Describa el destino del crÃ©dito. Este campo es obligatorio."})]})}),e.jsx("div",{className:"col-span-12 sm:col-span-4",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(m,{htmlFor:"ingresos_mensuales",children:"Ingresos mensuales (COP)"}),e.jsx("input",{id:"ingresos_mensuales",name:"ingresos_mensuales",type:"number",step:"0.01",value:r.ingresos_mensuales,onChange:c,ref:F,onKeyDown:s=>d(s,3),placeholder:"Ej: 80000000",className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"}),t.ingresos_mensuales?e.jsx("p",{className:"text-xs text-destructive mt-1",children:t.ingresos_mensuales}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total de ingresos mensuales, mayor que 0."})]})}),e.jsx("div",{className:"col-span-12 sm:col-span-4",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(m,{htmlFor:"egresos_mensuales",children:"Egresos mensuales (COP)"}),e.jsx("input",{id:"egresos_mensuales",name:"egresos_mensuales",type:"number",step:"0.01",value:r.egresos_mensuales,onChange:c,ref:S,onKeyDown:s=>d(s,4),placeholder:"Ej: 30000000",className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"}),t.egresos_mensuales?e.jsx("p",{className:"text-xs text-destructive mt-1",children:t.egresos_mensuales}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Total de egresos mensuales, mayor que 0."})]})}),e.jsx("div",{className:"col-span-12 sm:col-span-4",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(m,{htmlFor:"patrimonio",children:"Patrimonio (COP)"}),e.jsx("input",{id:"patrimonio",name:"patrimonio",type:"number",step:"0.01",value:r.patrimonio,onChange:c,ref:z,onKeyDown:s=>d(s,5),placeholder:"Ej: 120000000",className:"mt-1 w-full rounded-md border border-input bg-background px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"}),t.patrimonio?e.jsx("p",{className:"text-xs text-destructive mt-1",children:t.patrimonio}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Patrimonio neto, mayor que 0."})]})})]})]}),e.jsx("div",{className:"flex justify-end mt-12",children:e.jsx(H,{size:"lg",type:"submit",disabled:j,className:"min-w-[200px] bg-black text-white hover:bg-black/80",children:j?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"mr-2 w-5 h-5"}),"Enviando..."]}):"Guardar y Continuar"})})]})};export{J as default};
