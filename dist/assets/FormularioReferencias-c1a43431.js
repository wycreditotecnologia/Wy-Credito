import{r as s,j as t,L as d,I as u,B as _,A as I,a as K,b as P,d as L,g as $}from"./index-a97f1121.js";const O=({sessionId:A,onStepComplete:g,onProgressUpdate:b})=>{const[l,v]=s.useState([{nombre:"",contacto:""},{nombre:"",contacto:""}]),[h,N]=s.useState(!1),[i,x]=s.useState({}),[E,y]=s.useState(!1),[R,S]=s.useState(""),p=s.useRef(null),w=s.useRef(null),C=s.useRef(null),k=s.useRef(null),D=[p,w,C,k];s.useEffect(()=>{var e;(e=p.current)==null||e.focus()},[]),s.useEffect(()=>{typeof b=="function"&&b({currentQuestion:1,totalQuestions:4})},[b]);const m=(e,r,o)=>{v(c=>{const a=[...c];return a[e]={...a[e],[r]:o},a});const n=`ref_${e}_${r}`;i[n]&&x(c=>({...c,[n]:""}))},j=e=>{const r=String(e||"").trim();if(!r)return!1;const o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,n=r.replace(/\D/g,""),c=o.test(r),a=n.length>=7;return c||a},T=()=>{const e={},r=l[0];String(r.nombre||"").trim()||(e.ref_0_nombre="El nombre de la referencia 1 es obligatorio"),String(r.contacto||"").trim()?j(r.contacto)||(e.ref_0_contacto="Ingrese un email válido o un teléfono (≥7 dígitos)"):e.ref_0_contacto="El contacto de la referencia 1 es obligatorio";const o=l[1],n=!!(String(o.nombre||"").trim()||String(o.contacto||"").trim());return h&&n&&(String(o.nombre||"").trim()||(e.ref_1_nombre="El nombre de la referencia 2 es obligatorio si la añade"),String(o.contacto||"").trim()?j(o.contacto)||(e.ref_1_contacto="Ingrese un email válido o un teléfono (≥7 dígitos)"):e.ref_1_contacto="El contacto de la referencia 2 es obligatorio si la añade"),x(e),Object.keys(e).length===0},F=async e=>{if(e&&typeof e.preventDefault=="function"&&e.preventDefault(),!!T()){y(!0),S("");try{const r=l.filter(a=>String(a.nombre||"").trim()&&String(a.contacto||"").trim()&&j(a.contacto)).map(a=>({nombre:a.nombre.trim(),contacto:a.contacto.trim()})),o={};r[0]&&(o.nombre_referencia_1=r[0].nombre,o.telefono_referencia_1=r[0].contacto),r[1]&&(o.nombre_referencia_2=r[1].nombre,o.telefono_referencia_2=r[1].contacto);const n=await fetch("/api/orchestrator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"submit_form_step",sessionId:A,payload:{currentStep:4,stepData:o}})});if(!n.ok)throw new Error(`Error del servidor: ${n.status}`);const c=await n.json();console.log("Respuesta del orquestador:",c),g&&g(4)}catch(r){console.error("Error al enviar referencias:",r),S("Error al enviar la información. Por favor, inténtelo de nuevo.")}finally{y(!1)}}},f=(e,r)=>{var o;if(e.key==="Enter"){e.preventDefault();for(let n=r+1;n<D.length;n++){const c=(o=D[n])==null?void 0:o.current;if(c){c.focus();return}}F()}};return t.jsx("div",{className:"max-w-[800px] mx-auto p-3",children:t.jsxs("div",{className:"mt-12",children:[t.jsx("h1",{className:"text-3xl sm:text-4xl font-bold tracking-tight text-center mb-6",children:"Paso 4: Referencias Comerciales"}),t.jsx("p",{className:"text-muted-foreground text-center mb-6",children:"Proporcione información de dos referencias comerciales que puedan dar testimonio de la actividad y reputación de su empresa."}),t.jsxs("form",{onSubmit:F,className:"mt-6",children:[t.jsx("h3",{className:"text-xl font-semibold border-b pb-2 mt-12 mb-6",children:"Referencia Comercial #1"}),t.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[t.jsx("div",{className:"col-span-12 md:col-span-6",children:t.jsxs("div",{className:"mb-6",children:[t.jsx(d,{htmlFor:"ref1_nombre",children:"Nombre Completo - Referencia 1"}),t.jsx(u,{id:"ref1_nombre",value:l[0].nombre,onChange:e=>m(0,"nombre",e.target.value),placeholder:"Ej: Juan Carlos Pérez",ref:p,onKeyDown:e=>f(e,0)}),i.ref_0_nombre&&t.jsx("p",{className:"text-sm text-destructive mt-1",children:i.ref_0_nombre})]})}),t.jsx("div",{className:"col-span-12 md:col-span-6",children:t.jsxs("div",{className:"mb-6",children:[t.jsx(d,{htmlFor:"ref1_contacto",children:"Teléfono o Email - Referencia 1"}),t.jsx(u,{id:"ref1_contacto",value:l[0].contacto,onChange:e=>m(0,"contacto",e.target.value),placeholder:"Ej: 300 123 4567 o correo@ejemplo.com",ref:w,onKeyDown:e=>f(e,1)}),i.ref_0_contacto&&t.jsx("p",{className:"text-sm text-destructive mt-1",children:i.ref_0_contacto})]})})]}),!h&&t.jsx("div",{className:"mt-4",children:t.jsx(_,{type:"button",variant:"outline",onClick:()=>N(!0),children:"Añadir otra referencia"})}),h&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center justify-between mt-12",children:[t.jsx("h3",{className:"text-xl font-semibold border-b pb-2 mb-6",children:"Referencia Comercial #2 (opcional)"}),t.jsx(_,{type:"button",variant:"ghost",onClick:()=>{v(e=>[{...e[0]},{nombre:"",contacto:""}]),x(e=>({...e,ref_1_nombre:"",ref_1_contacto:""})),N(!1)},children:"Quitar"})]}),t.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[t.jsx("div",{className:"col-span-12 md:col-span-6",children:t.jsxs("div",{className:"mb-6",children:[t.jsx(d,{htmlFor:"ref2_nombre",children:"Nombre Completo - Referencia 2"}),t.jsx(u,{id:"ref2_nombre",value:l[1].nombre,onChange:e=>m(1,"nombre",e.target.value),placeholder:"Ej: María Elena Rodríguez",ref:C,onKeyDown:e=>f(e,2)}),i.ref_1_nombre&&t.jsx("p",{className:"text-sm text-destructive mt-1",children:i.ref_1_nombre})]})}),t.jsx("div",{className:"col-span-12 md:col-span-6",children:t.jsxs("div",{className:"mb-6",children:[t.jsx(d,{htmlFor:"ref2_contacto",children:"Teléfono o Email - Referencia 2"}),t.jsx(u,{id:"ref2_contacto",value:l[1].contacto,onChange:e=>m(1,"contacto",e.target.value),placeholder:"Ej: 301 987 6543 o correo@ejemplo.com",ref:k,onKeyDown:e=>f(e,3)}),i.ref_1_contacto&&t.jsx("p",{className:"text-sm text-destructive mt-1",children:i.ref_1_contacto})]})})]})]}),R&&t.jsxs(I,{variant:"destructive",className:"mb-6",children:[t.jsx(K,{className:"h-4 w-4"}),t.jsx(P,{children:"Error"}),t.jsx(L,{children:R})]}),t.jsx("div",{className:"mt-12 text-center",children:t.jsx(_,{type:"submit",disabled:E,className:"bg-black text-white hover:bg-black/80",children:E?t.jsxs(t.Fragment,{children:[t.jsx($,{className:"mr-2 w-5 h-5"}),"Enviando..."]}):"Guardar y Continuar"})})]})]})})};export{O as default};
